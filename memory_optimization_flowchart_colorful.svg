<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 1600 1200" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- æ¸å˜å®šä¹‰ -->
    <linearGradient id="startGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4CAF50;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#66BB6A;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="decisionGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FF9800;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#FFB74D;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="basicGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F44336;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#EF5350;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="advancedGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2196F3;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#42A5F5;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="performanceGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#9C27B0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#BA68C8;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="warningGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FF5722;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#FF7043;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="monitorGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#00BCD4;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#26C6DA;stop-opacity:1" />
    </linearGradient>
    
    <!-- é˜´å½±æ»¤é•œ -->
    <filter id="dropshadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="3" dy="3" stdDeviation="3" flood-color="#00000030"/>
    </filter>
    
    <!-- æ ·å¼å®šä¹‰ -->
    <style>
      .chinese { font-family: "SimSun", "å®‹ä½“", serif; font-size: 14px; fill: #333; font-weight: bold; }
      .english { font-family: "Times New Roman", serif; font-size: 12px; fill: #555; }
      .formula { font-family: "Times New Roman", serif; font-size: 11px; font-style: italic; fill: #2c3e50; }
      .title { font-family: "SimSun", "å®‹ä½“", serif; font-size: 24px; font-weight: bold; fill: #1a237e; }
      .subtitle { font-family: "SimSun", "å®‹ä½“", serif; font-size: 13px; fill: #546e7a; }
      .parameter { font-family: "Courier New", monospace; font-size: 10px; fill: #ffffff; font-weight: bold; }
      .benefit { font-family: "SimSun", "å®‹ä½“", serif; font-size: 10px; fill: #2e7d32; font-weight: bold; }
      
      .start-end { fill: url(#startGradient); stroke: #388E3C; stroke-width: 3; filter: url(#dropshadow); }
      .decision { fill: url(#decisionGradient); stroke: #F57C00; stroke-width: 3; filter: url(#dropshadow); }
      .basic-opt { fill: url(#basicGradient); stroke: #D32F2F; stroke-width: 3; filter: url(#dropshadow); }
      .advanced-opt { fill: url(#advancedGradient); stroke: #1976D2; stroke-width: 3; filter: url(#dropshadow); }
      .performance { fill: url(#performanceGradient); stroke: #7B1FA2; stroke-width: 3; filter: url(#dropshadow); }
      .warning-box { fill: url(#warningGradient); stroke: #D84315; stroke-width: 3; filter: url(#dropshadow); }
      .monitor-box { fill: url(#monitorGradient); stroke: #0097A7; stroke-width: 3; filter: url(#dropshadow); }
      .formula-box { fill: #f8f9fa; stroke: #607d8b; stroke-width: 2; stroke-dasharray: 5,5; filter: url(#dropshadow); }
    </style>
    
    <!-- ç®­å¤´æ ‡è®° -->
    <marker id="arrowhead" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#263238" />
    </marker>
    
    <marker id="arrowheadGreen" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#4CAF50" />
    </marker>
    
    <marker id="arrowheadRed" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#F44336" />
    </marker>
    
    <marker id="arrowheadBlue" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#2196F3" />
    </marker>
  </defs>
  
  <!-- èƒŒæ™¯ç½‘æ ¼ -->
  <defs>
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#e0e0e0" stroke-width="1" opacity="0.3"/>
    </pattern>
  </defs>
  <rect width="100%" height="100%" fill="url(#grid)" />
  
  <!-- æ ‡é¢˜åŒºåŸŸ -->
  <rect x="50" y="20" width="1500" height="80" rx="15" fill="#e8eaf6" stroke="#3f51b5" stroke-width="2" filter="url(#dropshadow)"/>
  <text x="800" y="50" text-anchor="middle" class="title">LLaMA Factory æ˜¾å­˜ä¼˜åŒ–å†³ç­–æ ‘</text>
  <text x="800" y="75" text-anchor="middle" class="subtitle">Memory Optimization Decision Tree for Large Language Model Training</text>
  
  <!-- ç¬¬ä¸€è¡Œï¼šå…¬å¼æ¡† -->
  <rect x="100" y="130" width="340" height="100" rx="10" class="formula-box"/>
  <text x="270" y="155" text-anchor="middle" class="chinese">æ˜¾å­˜æ¶ˆè€—ä¼°ç®—å…¬å¼</text>
  <text x="270" y="175" text-anchor="middle" class="formula">Memory â‰ˆ 1.5 Ã— (Model_Size + Optimizer_States)</text>
  <text x="270" y="190" text-anchor="middle" class="formula">+ Batch_Size Ã— Seq_LengthÂ² Ã— Hidden_Dim Ã— 4bytes</text>
  <text x="270" y="210" text-anchor="middle" class="subtitle">è€ƒè™‘æ¢¯åº¦ã€æ¿€æ´»å€¼å’Œä¼˜åŒ–å™¨çŠ¶æ€</text>
  
  <rect x="1160" y="130" width="340" height="100" rx="10" class="formula-box"/>
  <text x="1330" y="155" text-anchor="middle" class="chinese">LoRA å‚æ•°æ•ˆç‡å…¬å¼</text>
  <text x="1330" y="175" text-anchor="middle" class="formula">Trainable_Params = 2 Ã— d Ã— r Ã— num_layers</text>
  <text x="1330" y="190" text-anchor="middle" class="formula">Î”W = Î±/r Ã— B Ã— A, where B âˆˆ â„áµˆË£Ê³, A âˆˆ â„Ê³Ë£áµˆ</text>
  <text x="1330" y="210" text-anchor="middle" class="subtitle">r: rank, Î±: scaling factor, d: hidden dimension</text>
  
  <!-- ç¬¬äºŒè¡Œï¼šå¼€å§‹èŠ‚ç‚¹ -->
  <ellipse cx="800" cy="300" rx="100" ry="40" class="start-end"/>
  <text x="800" y="290" text-anchor="middle" class="chinese">ğŸš€ å¯åŠ¨è®­ç»ƒè¿›ç¨‹</text>
  <text x="800" y="310" text-anchor="middle" class="english">Initialize Training Process</text>
  
  <!-- ç¬¬ä¸‰è¡Œï¼šç¬¬ä¸€ä¸ªå†³ç­–ç‚¹ -->
  <polygon points="800,380 900,420 800,460 700,420" class="decision"/>
  <text x="800" y="410" text-anchor="middle" class="chinese">ğŸ” æ˜¾å­˜çŠ¶æ€æ£€æµ‹</text>
  <text x="800" y="430" text-anchor="middle" class="english">Memory Assessment</text>
  
  <!-- ç¬¬å››è¡Œï¼šä¼˜åŒ–ç­–ç•¥ -->
  <!-- åŸºç¡€ä¼˜åŒ– -->
  <rect x="150" y="520" width="220" height="160" rx="15" class="basic-opt"/>
  <text x="260" y="550" text-anchor="middle" class="chinese">ğŸ› ï¸ åŸºç¡€ä¼˜åŒ–ç­–ç•¥</text>
  <text x="260" y="570" text-anchor="middle" class="english">Basic Optimization</text>
  <text x="260" y="595" text-anchor="middle" class="parameter">per_device_train_batch_size = 1</text>
  <text x="260" y="615" text-anchor="middle" class="parameter">bf16 = True</text>
  <text x="260" y="635" text-anchor="middle" class="parameter">cutoff_len = 1024</text>
  <text x="260" y="655" text-anchor="middle" class="benefit">ğŸ’¾ å‡å°‘50%æ˜¾å­˜å ç”¨</text>
  
  <!-- é«˜çº§ä¼˜åŒ– -->
  <rect x="420" y="520" width="220" height="160" rx="15" class="advanced-opt"/>
  <text x="530" y="550" text-anchor="middle" class="chinese">âš¡ é«˜çº§ä¼˜åŒ–ç­–ç•¥</text>
  <text x="530" y="570" text-anchor="middle" class="english">Advanced Optimization</text>
  <text x="530" y="595" text-anchor="middle" class="parameter">flash_attn = "fa2"</text>
  <text x="530" y="615" text-anchor="middle" class="parameter">liger_kernel = True</text>
  <text x="530" y="635" text-anchor="middle" class="parameter">gradient_checkpointing = True</text>
  <text x="530" y="655" text-anchor="middle" class="benefit">ğŸš€ é¢å¤–èŠ‚çœ30-40%æ˜¾å­˜</text>
  
  <!-- æ€§èƒ½è°ƒä¼˜ -->
  <rect x="960" y="520" width="220" height="160" rx="15" class="performance"/>
  <text x="1070" y="550" text-anchor="middle" class="chinese">ğŸ“ˆ æ€§èƒ½è°ƒä¼˜ç­–ç•¥</text>
  <text x="1070" y="570" text-anchor="middle" class="english">Performance Tuning</text>
  <text x="1070" y="595" text-anchor="middle" class="parameter">cutoff_len = 2048-4096</text>
  <text x="1070" y="615" text-anchor="middle" class="parameter">lora_rank = 16-64</text>
  <text x="1070" y="635" text-anchor="middle" class="parameter">learning_rate = 5e-4</text>
  <text x="1070" y="655" text-anchor="middle" class="benefit">âœ¨ æå‡è®­ç»ƒæ•ˆæœ</text>
  
  <!-- ç¬¬äº”è¡Œï¼šç¬¬äºŒä¸ªå†³ç­–ç‚¹ -->
  <polygon points="800,750 900,790 800,830 700,790" class="decision"/>
  <text x="800" y="780" text-anchor="middle" class="chinese">âœ… è®­ç»ƒç¨³å®šæ€§æ£€æŸ¥</text>
  <text x="800" y="800" text-anchor="middle" class="english">Training Stability Check</text>
  
  <!-- ç¬¬å…­è¡Œï¼šæœ€ç»ˆå¤„ç† -->
  <!-- é™çº§ç­–ç•¥ -->
  <rect x="200" y="900" width="250" height="180" rx="15" class="warning-box"/>
  <text x="325" y="930" text-anchor="middle" class="chinese">âš ï¸ é™çº§ç­–ç•¥</text>
  <text x="325" y="950" text-anchor="middle" class="english">Fallback Strategy</text>
  <text x="325" y="975" text-anchor="middle" class="parameter">cutoff_len = 512</text>
  <text x="325" y="995" text-anchor="middle" class="parameter">lora_rank = 8</text>
  <text x="325" y="1015" text-anchor="middle" class="parameter">lora_alpha = 16</text>
  <text x="325" y="1035" text-anchor="middle" class="parameter">deepspeed_stage = 3</text>
  <text x="325" y="1055" text-anchor="middle" class="parameter">cpu_offload = True</text>
  <text x="325" y="1075" text-anchor="middle" class="benefit">ğŸ”§ æé™æ˜¾å­˜èŠ‚çœæ¨¡å¼</text>
  
  <!-- ç›‘æ§è®­ç»ƒ -->
  <rect x="600" y="900" width="250" height="140" rx="15" class="monitor-box"/>
  <text x="725" y="930" text-anchor="middle" class="chinese">ğŸ“Š è®­ç»ƒç›‘æ§</text>
  <text x="725" y="950" text-anchor="middle" class="english">Training Monitoring</text>
  <text x="725" y="975" text-anchor="middle" class="parameter">Loss Convergence Tracking</text>
  <text x="725" y="995" text-anchor="middle" class="parameter">Memory Utilization < 85%</text>
  <text x="725" y="1015" text-anchor="middle" class="parameter">Gradient Norm Stability</text>
  
  <!-- æˆåŠŸèŠ‚ç‚¹ -->
  <ellipse cx="1100" cy="970" rx="100" ry="40" class="start-end"/>
  <text x="1100" y="960" text-anchor="middle" class="chinese">ğŸ‰ è®­ç»ƒæˆåŠŸ</text>
  <text x="1100" y="980" text-anchor="middle" class="english">Training Success</text>
  
  <!-- ä¼˜åŒ–æŠ€å·§åº•éƒ¨ä¿¡æ¯æ¡† -->
  <rect x="50" y="1120" width="1500" height="80" rx="10" class="formula-box"/>
  <text x="800" y="1145" text-anchor="middle" class="chinese">ğŸ”‘ å…³é”®ä¼˜åŒ–æŠ€å·§ä¸æ€§èƒ½æŒ‡æ ‡</text>
  
  <text x="200" y="1165" text-anchor="middle" class="subtitle">Flash Attention:</text>
  <text x="200" y="1180" text-anchor="middle" class="formula">O(N) vs O(NÂ²)</text>
  
  <text x="450" y="1165" text-anchor="middle" class="subtitle">DeepSpeed ZeRO-3:</text>
  <text x="450" y="1180" text-anchor="middle" class="formula">Memory/GPU = Params/N_GPUs</text>
  
  <text x="750" y="1165" text-anchor="middle" class="subtitle">æ¢¯åº¦ç´¯ç§¯:</text>
  <text x="750" y="1180" text-anchor="middle" class="formula">Batch = Micro Ã— Steps</text>
  
  <text x="1000" y="1165" text-anchor="middle" class="subtitle">æ··åˆç²¾åº¦:</text>
  <text x="1000" y="1180" text-anchor="middle" class="formula">BF16: 50% memory â†“</text>
  
  <text x="1300" y="1165" text-anchor="middle" class="subtitle">Liger Kernel:</text>
  <text x="1300" y="1180" text-anchor="middle" class="formula">2-3x speedup</text>
  
  <!-- æµç¨‹ç®­å¤´ -->
  <!-- å¼€å§‹åˆ°å†³ç­– -->
  <line x1="800" y1="340" x2="800" y2="375" stroke="#263238" stroke-width="4" marker-end="url(#arrowhead)"/>
  
  <!-- å†³ç­–åˆ°ä¼˜åŒ–ç­–ç•¥ -->
  <line x1="730" y1="440" x2="360" y2="505" stroke="#F44336" stroke-width="4" marker-end="url(#arrowheadRed)"/>
  <text x="545" y="470" class="chinese" fill="#F44336" font-weight="bold">âŒ OOM é”™è¯¯</text>
  
  <line x1="720" y1="450" x2="530" y2="505" stroke="#2196F3" stroke-width="4" marker-end="url(#arrowheadBlue)"/>
  <text x="625" y="485" class="chinese" fill="#2196F3" font-weight="bold">âš ï¸ ä»ç„¶OOM</text>
  
  <line x1="870" y1="440" x2="1070" y2="505" stroke="#4CAF50" stroke-width="4" marker-end="url(#arrowheadGreen)"/>
  <text x="970" y="470" class="chinese" fill="#4CAF50" font-weight="bold">âœ… æ˜¾å­˜å……è¶³</text>
  
  <!-- ä¼˜åŒ–ç­–ç•¥åˆ°ç¨³å®šæ€§æ£€æŸ¥ -->
  <line x1="260" y1="680" x2="730" y2="735" stroke="#263238" stroke-width="3" marker-end="url(#arrowhead)"/>
  <line x1="530" y1="680" x2="770" y2="735" stroke="#263238" stroke-width="3" marker-end="url(#arrowhead)"/>
  <line x1="1070" y1="680" x2="830" y2="735" stroke="#263238" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <!-- ç¨³å®šæ€§æ£€æŸ¥åˆ°æœ€ç»ˆå¤„ç† -->
  <line x1="730" y1="810" x2="450" y2="885" stroke="#FF5722" stroke-width="4" marker-end="url(#arrowheadRed)"/>
  <text x="590" y="845" class="chinese" fill="#FF5722" font-weight="bold">âŒ ä¸ç¨³å®š</text>
  
  <line x1="800" y1="830" x2="725" y2="885" stroke="#00BCD4" stroke-width="4" marker-end="url(#arrowhead)"/>
  <text x="825" y="860" class="chinese" fill="#00BCD4" font-weight="bold">âœ… ç¨³å®šè¿è¡Œ</text>
  
  <!-- ç›‘æ§åˆ°æˆåŠŸ -->
  <line x1="850" y1="970" x2="1000" y2="970" stroke="#4CAF50" stroke-width="4" marker-end="url(#arrowheadGreen)"/>
  
  <!-- é‡æ–°è¯„ä¼°è·¯å¾„ -->
  <path d="M 325 1080 Q 150 1100 100 800 Q 100 400 700 410" 
        stroke="#FF9800" stroke-width="3" fill="none" stroke-dasharray="8,8" marker-end="url(#arrowhead)"/>
  <text x="180" y="950" class="subtitle" fill="#FF9800" font-weight="bold">ğŸ”„ é‡æ–°è¯„ä¼°</text>
  
</svg> 